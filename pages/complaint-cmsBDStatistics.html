<div class="row">
    <div class="col-md-12">
        <h1>BD CMS Statistics</h1>
    </div>
</div> 

<div class="form-group row">
    <label for="startDate" class="col-md-1 col-form-label form-label-width">Start Date</label>
    <div class="col-md-3">
        <input type="date" id="startDate" class="form-control mx-sm-2" data-ng-model="obj.startDate"/>
    </div>
</div>    

<div class="form-group row">
    <label for="endDate" class="col-md-1 col-form-label form-label-width">End Date</label>
    <div class="col-md-3">
        <input type="date" id="endDate" class="form-control mx-sm-2" data-ng-model="obj.endDate"/>
    </div>
</div>
<div class="form-group row">
    <label for="zon" class="col-md-1 col-form-label form-label-width">Branch</label>
    <div class="col-md-3">
        <select id="zon" class="form-control mx-sm-2" data-ng-model="obj.zon">
            <option value="KCH" selected>KCH</option>
            <option value="BTU">BTU</option>
        </select>
    </div>
</div>
<div class="row">
    <div class="col-md-12">
        <button class="btn btn-primary" data-ng-click="objChange()" >Generate</button>
    </div>
</div>

<hr/>
<ul class="nav nav-tabs">
    <li class="nav-item"><a class="nav-link active" data-toggle="tab" data-target="#mw">MW</a></li>
    <li class="nav-item"><a class="nav-link" data-toggle="tab" data-target="#roro">RORO</a></li>
    <li class="nav-item"><a class="nav-link" data-toggle="tab" data-target="#sw">SW</a></li>
</ul>
<br/>
<div class="tab-content">
    <div id="mw" class="tab-pane fade show active">
        <div class="row">
            <div class="col-md-10">
                <h5>Municipal Waste Services</h5>
            </div>
            <div class="col-md-2">
                <a href="javascript:exportTableToExcel('mwTable', 'BdMWData')" class="btn btn-md btn-primary clearfix">Export to Excel</a>
            </div>
        </div>
        <div class="row">
            <div class="col-md-12">
                <div class="table-responsive">
                    <table class="table table-bordered" id="mwTable">
                        <tr>
                            <th width="70%">Overall total no. of complaints received</th>
                            <td colspan="2" width="30%">{{mwData.totalComp}}</td>
                        </tr>
                        <tr>
                            <th>Response time analysis for CMS</th>
                            <td colspan="2">{{mwData.achieveKPI / mwData.totalComp * 100 | number:2}} %</td>
                        </tr>
                        <tr>
                            <th>Overall total no. of valid complaints</th>
                            <td colspan="2">{{mwData.tsValid + mwData.takValid + mwData.mpValid}}</td>
                        </tr>
                        <tr>
                            <td>TS</td>
                            <td width="15%">{{mwData.tsValid}}</td>
                            <td width="15%">{{ mwData.tsValid / (mwData.tsValid + mwData.takValid + mwData.mpValid) * 100 | number:2}} %</td>
                        </tr>
                        <tr>
                            <td>Mega Power</td>
                            <td>{{mwData.mpValid}}</td>
                            <td>{{ mwData.mpValid / (mwData.tsValid + mwData.takValid + mwData.mpValid) * 100 | number:2}} %</td>
                        </tr>
                        <tr>
                            <td>Toh Ah Kaw</td>
                            <td>{{mwData.takValid}}</td>
                            <td>{{ mwData.takValid / (mwData.tsValid + mwData.takValid + mwData.mpValid) * 100 | number:2}} %</td>
                        </tr>
                        <tr>
                            <th colspan="3">
                                Legend of category codes
                            </th>
                        </tr>
                        <tr>
                            <td>1. Waste Not Collected</td>
                            <td>{{mwData.wasteNotCollected}}</td>
                            <td>{{mwData.wasteNotCollected / (mwData.wasteNotCollected + mwData.binNotPushBack + mwData.spillageWaste + mwData.spillageLeachate + mwData.otherType) * 100 | number:2}} %</td>
                        </tr>
                        <tr>
                            <td>2. Bin not pushed back to its original location</td>
                            <td>{{mwData.binNotPushBack}}</td>
                            <td>{{mwData.binNotPushBack / (mwData.wasteNotCollected + mwData.binNotPushBack + mwData.spillageWaste + mwData.spillageLeachate + mwData.otherType) * 100 | number:2}} %</td>
                        </tr>
                        <tr>
                            <td>3. Spillage of waste</td>
                            <td>{{mwData.spillageWaste}}</td>
                            <td>{{mwData.spillageWaste / (mwData.wasteNotCollected + mwData.binNotPushBack + mwData.spillageWaste + mwData.spillageLeachate + mwData.otherType) * 100 | number:2}} %</td>
                        </tr>
                        <tr>
                            <td>4. Spillage of leachate water</td>
                            <td>{{mwData.spillageLeachate}}</td>
                            <td>{{mwData.spillageLeachate / (mwData.wasteNotCollected + mwData.binNotPushBack + mwData.spillageWaste + mwData.spillageLeachate + mwData.otherType) * 100 | number:2}} %</td>
                        </tr>
                        <tr>
                            <td>Others</td>
                            <td>{{mwData.otherType}}</td>
                            <td>{{mwData.otherType / (mwData.wasteNotCollected + mwData.binNotPushBack + mwData.spillageWaste + mwData.spillageLeachate + mwData.otherType) * 100 | number:2}} %</td>
                        </tr>
                        <tr>
                            <th colspan="3">Complaints By Council</th>
                        </tr>
                        <tr>
                            <td>1. DBKU</td>
                            <td>{{mwData.dbku}}</td>
                            <td>{{mwData.dbku / (mwData.dbku + mwData.mbks + mwData.mpp + mwData.others) * 100 | number:2}} %</td>
                        </tr>
                        <tr>
                            <td>2. MBKS</td>
                            <td>{{mwData.mbks}}</td>
                            <td>{{mwData.mbks / (mwData.dbku + mwData.mbks + mwData.mpp + mwData.others) * 100 | number:2}} %</td>
                        </tr>
                        <tr>
                            <td>3. MPP</td>
                            <td>{{mwData.mpp}}</td>
                            <td>{{mwData.mpp / (mwData.dbku + mwData.mbks + mwData.mpp + mwData.others) * 100 | number:2}} %</td>
                        </tr>
                        <tr>
                            <td>Others</td>
                            <td>{{mwData.others}}</td>
                            <td>{{mwData.others / (mwData.dbku + mwData.mbks + mwData.mpp + mwData.others) * 100 | number:2}} %</td>
                        </tr>
                    </table>
                </div>
            </div>
        </div>
    </div>
    <div id="roro" class="tab-pane fade">
        <div class="row">
            <div class="col-md-10">
                <h5>Roro Container Services</h5>
            </div>
            <div class="col-md-2">
                <a href="javascript:exportTableToExcel('roroTable', 'BdRoroData')" class="btn btn-md btn-primary clearfix">Export to Excel</a>
            </div>
        </div>
        <div class="row">
            <div class="col-md-12">
                <div class="table-responsive">
                    <table class="table table-bordered" id="roroTable">
                        <tr>
                            <th width="70%">Overall total no. of complaints received</th>
                            <td colspan="2" width="30%">{{roroData.totalComp}}</td>
                        </tr>
                        <tr>
                            <th>Response time analysis for CMS</th>
                            <td colspan="2">{{roroData.achieveKPI / roroData.totalComp * 100 | number:2}} %</td>
                        </tr>
                        <tr>
                            <th>Overall total no. of valid complaints</th>
                            <td colspan="2">{{roroData.tsValid + roroData.takValid + roroData.mpValid}}</td>
                        </tr>
                        <tr>
                            <td>TS</td>
                            <td width="15%">{{roroData.tsValid}}</td>
                            <td width="15%">{{roroData.tsValid / (roroData.tsValid + roroData.takValid + roroData.mpValid) * 100 | number:2}} %</td>
                        </tr>
                        <tr>
                            <td>Mega Power</td>
                            <td>{{roroData.mpValid}}</td>
                            <td>{{roroData.mpValid / (roroData.tsValid + roroData.takValid + roroData.mpValid) * 100 | number:2}} %</td>
                        </tr>
                        <tr>
                            <td>Toh Ah Kaw</td>
                            <td>{{roroData.takValid}}</td>
                            <td>{{roroData.mpValid / (roroData.tsValid + roroData.takValid + roroData.mpValid) * 100 | number:2}} %</td>
                        </tr>
                        <tr>
                            <th colspan="3">
                                Legend of category codes
                            </th>
                        </tr>
                        <tr>
                            <td>5. Container not sent</td>
                            <td>{{roroData.containerNotSent}}</td>
                            <td>{{roroData.containerNotSent / (roroData.containerNotSent + roroData.containerNotExchanged + roroData.containerNotPulled + roroData.containerNotEmptied + roroData.otherType) * 100 | number:2}} %<td>
                        </tr>
                        <tr>
                            <td>6. Container not exchanged</td>
                            <td>{{roroData.containerNotExchanged}}</td>
                            <td>{{roroData.containerNotExchanged / (roroData.containerNotSent + roroData.containerNotExchanged + roroData.containerNotPulled + roroData.containerNotEmptied + roroData.otherType) * 100 | number:2}} %</td>
                        </tr>
                        <tr>
                            <td>7. Container not pulled</td>
                            <td>{{roroData.containerNotPulled}}</td>
                            <td>{{roroData.containerNotPulled / (roroData.containerNotSent + roroData.containerNotExchanged + roroData.containerNotPulled + roroData.containerNotEmptied + roroData.otherType) * 100 | number:2}} %</td>
                        </tr>
                        <tr>
                            <td>8. Container not emptied</td>
                            <td>{{roroData.containerNotEmptied}}</td>
                            <td>{{roroData.containerNotEmptied / (roroData.containerNotSent + roroData.containerNotExchanged + roroData.containerNotPulled + roroData.containerNotEmptied + roroData.otherType) * 100 | number:2}} %</td>
                        </tr>
                        <tr>
                            <td>Others</td>
                            <td>{{roroData.otherType}}</td>
                            <td>{{roroData.otherType / (roroData.containerNotSent + roroData.containerNotExchanged + roroData.containerNotPulled + roroData.containerNotEmptied + roroData.otherType) * 100 | number:2}} %</td>
                        </tr>
                    </table>
                </div>
            </div>
        </div>
    </div>
    <div id="sw" class="tab-pane fade">
        <div class="row">
            <div class="col-md-10">
                <h5>Scheduled Waste Services</h5>
            </div>
            <div class="col-md-2">
                <a href="javascript:exportTableToExcel('swTable', 'BdSWData')" class="btn btn-md btn-primary clearfix">Export to Excel</a>
            </div>
        </div>
        <div class="row">
            <div class="col-md-12">
                <div class="table-responsive">
                    <table class="table table-bordered" id="swTable">
                        <tr>
                            <th width="70%">Overall total no. of complaints received</th>
                            <td colspan="2" width="30%">{{swData.totalComp}}</td>
                        </tr>
                        <tr>
                            <th>Response time analysis for CMS</th>
                            <td colspan="2">{{swData.achieveKPI / swData.totalComp * 100 | number:2}} %</td>
                        </tr>
                        <tr>
                            <th>Overall total no. of valid complaints</th>
                            <td colspan="2">{{swData.tsValid + swData.innatechValid + swData.petroJadiValid + swData.otherSubconValid}}</td>
                        </tr>
                        <tr>
                            <td>TS</td>
                            <td width="15%">{{swData.tsValid}}</td>
                            <td width="15%">{{swData.tsValid / (swData.tsValid + swData.petroJadiValid + swData.innatechValid + swData.otherSubconValid) * 100 | number:2}} %</td>
                        </tr>
                        <tr>
                            <td>Innatech</td>
                            <td>{{swData.innatechValid}}</td>
                            <td>{{swData.innatechValid / (swData.tsValid + swData.petroJadiValid + swData.innatechValid + swData.otherSubconValid) * 100 | number:2}} %</td>
                        </tr>
                        <tr>
                            <td>Petro Jadi</td>
                            <td>{{swData.petroJadiValid}}</td>
                            <td>{{swData.petroJadiValid / (swData.tsValid + swData.petroJadiValid + swData.innatechValid + swData.otherSubconValid) * 100 | number:2}} %</td>
                        </tr>
                        <tr>
                            <td>Others</td>
                            <td>{{swData.otherSubconValid}}</td>
                            <td>{{swData.otherSubconValid / (swData.tsValid + swData.petroJadiValid + swData.innatechValid + swData.otherSubconValid) * 100 | number:2}} %</td>
                        </tr>
                        <tr>
                            <th colspan="3">
                                Legend of category codes
                            </th>
                        </tr>
                        <tr>
                            <td>1. Waste not collected</td>
                            <td>{{swData.wasteNotCollected}}</td>
                            <td>{{swData.wasteNotCollected  / (swData.wasteNotCollected + swData.spillage + swData.incompleteDocs + swData.others) * 100 | number:2}} %</td>
                        </tr>
                        <tr>
                            <td>2. Spillage during collection</td>
                            <td>{{swData.spillage}}</td>
                            <td>{{swData.spillage  / (swData.wasteNotCollected + swData.spillage + swData.incompleteDocs + swData.others) * 100 | number:2}} %</td>
                        </tr>
                        <tr>
                            <td>3. Incomplete documents/td>
                            <td>{{swData.incompleteDocs}}</td>
                            <td>{{swData.incompleteDocs  / (swData.wasteNotCollected + swData.spillage + swData.incompleteDocs + swData.others) * 100 | number:2}} %</td>
                        </tr>
                        <tr>
                            <td>Others</td>
                            <td>{{swData.others}}</td>
                            <td>{{swData.others  / (swData.wasteNotCollected + swData.spillage + swData.incompleteDocs + swData.others) * 100 | number:2}} %</td>
                        </tr>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>
<br/>
<script>

    function exportTableToExcel(tableID, filename = ''){
        var downloadLink;
        var dataType = 'application/vnd.ms-excel';
        var tableSelect = document.getElementById(tableID);
        var tableHTML = tableSelect.outerHTML.replace(/ /g, '%20');
        
        // Specify file name
        filename = filename?filename+'.xls':'data.xls';
        
        // Create download link element
        downloadLink = document.createElement("a");
        
        document.body.appendChild(downloadLink);
        
        if(navigator.msSaveOrOpenBlob){
            var blob = new Blob(['\ufeff', tableHTML], {
                type: dataType
            });
            navigator.msSaveOrOpenBlob( blob, filename);
        }else{
            // Create a link to the file
            downloadLink.href = 'data:' + dataType + ', ' + tableHTML;
        
            // Setting the file name
            downloadLink.download = filename;
            
            //triggering the function
            downloadLink.click();
        }
    }
</script>  